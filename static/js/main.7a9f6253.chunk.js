(this.webpackJsonpspeechstate=this.webpackJsonpspeechstate||[]).push([[0],{170:function(t,e,n){},218:function(t,e){},357:function(t,e){},360:function(t,e){},364:function(t,e){},365:function(t,e){},366:function(t,e){},367:function(t,e){},368:function(t,e){},456:function(t,e,n){"use strict";n.r(e);var o=n(166),r=n(9),i=(n(170),n(15),n(159)),a=n(26),c=n(94),s=n(3),u=n(459),d=n(460);function l(t){return Object(s.q)((function(e){return{type:"SPEAK",value:t}}))}function f(t){return Object(s.q)(t)}function m(t,e,n){return{initial:"prompt",entry:[Object(s.b)({correction:function(t){return t.correction=0}}),Object(s.b)({timeout:function(t){return t.timeout=0}})],states:{prompt:{entry:f(t),on:{ENDSPEECH:"ask"}},ask:{entry:Object(s.q)("LISTEN"),on:{RECOGNISED:{target:"cMgnt",actions:[Object(s.b)({whatissaid:function(t){return t.recResult[0].utterance}}),Object(s.b)({clevel:function(t){return t.recResult[0].confidence}})]},TIMEOUT:[{target:"prompt",cond:function(t){return t.timeout<3},actions:Object(s.b)({timeout:function(t){return t.timeout+1}})},{target:"#root.dm.init"}]}},cMgnt:{entry:function(t){return console.log(t.clevel)},always:[{target:"cReq",cond:function(t){return t.clevel<.5}},{target:"mainTaskProcessing"}]},cReq:{initial:"prompt",states:{prompt:{entry:f((function(t){return{type:"SPEAK",value:"Did you say ".concat(t.whatissaid,".")}})),on:{ENDSPEECH:"confirmation"}},confirmation:{entry:Object(s.q)("LISTEN")}},on:{RECOGNISED:[{target:"cReqProcessing",cond:function(t){return"answer"in(y[t.recResult[0].utterance]||{})},actions:Object(s.b)({answer:function(t){return y[t.recResult[0].utterance].answer}})},{target:"#root.dm.help",cond:function(t){return"Help."===t.recResult[0].utterance}},{target:".prompt"}],TIMEOUT:[{target:".prompt"}]}},cReqProcessing:{always:[{target:"mainTaskProcessing",cond:function(t){return"Yes."===t.answer}},{target:"prompt",cond:function(t){return"No."===t.answer}}]},mainTaskProcessing:{always:[{target:"proceed",cond:function(t){return"answer"in(y[t.whatissaid]||{})},actions:Object(s.b)({answer:function(t){return y[t.whatissaid].answer}})},{target:"#root.dm.help",cond:function(t){return"Help."===t.whatissaid}},{target:"gate"}]},proceed:{always:[{target:e,cond:function(t){return"Yes."===t.answer}},{target:n,cond:function(t){return"No."===t.answer}}]},gate:{entry:function(t){return console.log("Correction count: ".concat(t.correction))},always:[{target:"firstConfusion",cond:function(t){return 0===t.correction}},{target:"secondConfusion",cond:function(t){return 1===t.correction}},{target:"thirdConfusion",cond:function(t){return 2===t.correction}}]},firstConfusion:Object(r.a)({},g("I do not understand. Please tell me again.","prompt")),secondConfusion:Object(r.a)({},g("I still do not understand. Please tell me again.","prompt")),thirdConfusion:Object(r.a)({},g("This is not going anywhere. Good bye.","#root.dm.init"))}}}function p(t,e,n,o){return{initial:"prompt",entry:[Object(s.b)({correction:function(t){return t.correction=0}}),Object(s.b)({timeout:function(t){return t.timeout=0}})],states:{prompt:{entry:f(t),on:{ENDSPEECH:"ask"}},ask:{entry:Object(s.q)("LISTEN"),on:{RECOGNISED:{target:"cMgnt",actions:[Object(s.b)({whatissaid:function(t){return t.recResult[0].utterance}}),Object(s.b)({clevel:function(t){return t.recResult[0].confidence}})]},TIMEOUT:[{target:"prompt",cond:function(t){return t.timeout<3},actions:Object(s.b)({timeout:function(t){return t.timeout+1}})},{target:"#root.dm.init"}]}},cMgnt:{entry:function(t){return console.log(t.clevel)},always:[{target:"cReq",cond:function(t){return t.clevel<.5}},{target:"mainTaskProcessing"}]},cReq:{initial:"prompt",states:{prompt:{entry:f((function(t){return{type:"SPEAK",value:"Did you say ".concat(t.whatissaid,".")}})),on:{ENDSPEECH:"confirmation"}},confirmation:{entry:Object(s.q)("LISTEN")}},on:{RECOGNISED:[{target:"cReqProcessing",cond:function(t){return"answer"in(y[t.recResult[0].utterance]||{})},actions:Object(s.b)({answer:function(t){return y[t.recResult[0].utterance].answer}})},{target:"#root.dm.help",cond:function(t){return"Help."===t.recResult[0].utterance}},{target:".prompt"}],TIMEOUT:[{target:".prompt"}]}},cReqProcessing:{always:[{target:"mainTaskProcessing",cond:function(t){return"Yes."===t.answer}},{target:"prompt",cond:function(t){return"No."===t.answer}}]},mainTaskProcessing:{always:[{target:e,cond:function(t){return n in(y[t.whatissaid]||{})},actions:Object(s.b)(o)},{target:"#root.dm.help",cond:function(t){return"Help."===t.whatissaid}},{target:"gate"}]},gate:{entry:function(t){return console.log("Correction count: ".concat(t.correction))},always:[{target:"firstConfusion",cond:function(t){return 0===t.correction}},{target:"secondConfusion",cond:function(t){return 1===t.correction}},{target:"thirdConfusion",cond:function(t){return 2===t.correction}}]},firstConfusion:Object(r.a)({},g("I do not understand. Please tell me again.","prompt")),secondConfusion:Object(r.a)({},g("I still do not understand. Please tell me again.","prompt")),thirdConfusion:Object(r.a)({},g("This is not going anywhere. Good bye.","#root.dm.init"))}}}function g(t,e){return{entry:l(t),on:{ENDSPEECH:{target:e,internal:!1,actions:Object(s.b)({correction:function(t){return t.correction+1}})}}}}var y={"Lecture.":{title:"Dialogue systems lecture"},"Lunch.":{title:"Lunch at the canteen"},"on Friday.":{day:"Friday"},Monday:{day:"Monday"},Tuesday:{day:"Tuesday"},Wednesday:{day:"Wednesday"},Thursday:{day:"Thursday"},Friday:{day:"Friday"},Saturday:{day:"Saturday"},Sunday:{day:"Sunday"},"Monday.":{day:"Monday"},"Tuesday.":{day:"Tuesday"},"Wednesday.":{day:"Wednesday"},"Thursday.":{day:"Thursday"},"Friday.":{day:"Friday"},"Saturday.":{day:"Saturday"},"Sunday.":{day:"Sunday"},"At ten.":{time:"10:00"},"At 10":{time:"10:00"},"At 10.":{time:"10:00"},"At 10:00 o'clock.":{time:"10:00"},"At 10 am.":{time:"10:00"},"Yes.":{answer:"Yes."},"Yeah.":{answer:"Yes."},"Yep.":{answer:"Yes."},"No.":{answer:"No."},"Nope.":{answer:"No."},"Activate robot.":{robot:"Active."},"Robot activation.":{robot:"Active."}},b={initial:"idle",states:{idle:{on:{CLICK:"init"}},init:{on:{TTS_READY:"conversation",CLICK:"conversation"}},help:{entry:l("Calm down. I will walk you through this."),on:{ENDSPEECH:"#root.dm.conversation.hist"}},conversation:{entry:Object(s.b)({user:function(t){return t.user="Max"}}),initial:"welcome",states:{hist:{type:"history",history:"shallow"},welcome:Object(r.a)(Object(r.a)({},{initial:"prompt",entry:[Object(s.b)({correction:function(t){return t.correction=0}}),Object(s.b)({timeout:function(t){return t.timeout=0}})]}),{},{states:Object(r.a)({prompt:{entry:Object(s.q)((function(t){return{type:"SPEAK",value:"Hi ".concat(t.user,"!")}})),on:{ENDSPEECH:"ask"}},ask:{entry:Object(s.q)("LISTEN")}},{gate:{entry:function(t){return console.log("Correction count: ".concat(t.correction))},always:[{target:"firstConfusion",cond:function(t){return 0===t.correction}},{target:"secondConfusion",cond:function(t){return 1===t.correction}},{target:"thirdConfusion",cond:function(t){return 2===t.correction}}]},firstConfusion:Object(r.a)({},g("I do not understand. Please tell me again.","prompt")),secondConfusion:Object(r.a)({},g("I still do not understand. Please tell me again.","prompt")),thirdConfusion:Object(r.a)({},g("This is not going anywhere. Good bye.","#root.dm.init"))}),on:{RECOGNISED:[{target:"#root.dm.conversation.createMeeting",cond:function(t){return"Create a meeting."===t.recResult[0].utterance}},{target:"#root.dm.conversation.XIs",cond:function(t){return"Who is"===t.recResult[0].utterance.split(" ").slice(0,2).join(" ")},actions:[Object(s.b)({person:function(t){return function(t){var e=t.split(" "),n=e.length;return e.slice(2,n).join(" ").replace("?","")}(t.recResult[0].utterance)}})]},{target:"robotAction",cond:function(t){return"robot"in(y[t.recResult[0].utterance]||{})}},{target:".gate"}],TIMEOUT:[{target:".prompt",cond:function(t){return t.timeout<3},actions:Object(s.b)({timeout:function(t){return t.timeout+1}})},{target:"#root.dm.init"}]}}),XIs:{initial:"getFeature",states:{getFeature:{invoke:{id:"getFeature",src:function(t,e){return E(t.person)},onDone:{target:"success",actions:[Object(s.b)({feature:function(t,e){return e.data.AbstractText}}),Object(s.b)({title:function(t){return"meeting with ".concat(t.person)}})]},onError:{target:"fail"}}},success:{entry:Object(s.q)((function(t){return{type:"SPEAK",value:(e=t.feature,n=1,e.split(". ").slice(0,n).join(". "))};var e,n})),on:{ENDSPEECH:"#root.dm.conversation.MeetX"}},fail:{entry:l("Sorry. I do not know this person."),on:{ENDSPEECH:"#root.dm.init"}}}},robotAction:{initial:"askIntent",states:{askIntent:{initial:"prompt",states:{prompt:{entry:l("What do you want me to do?"),on:{ENDSPEECH:"ask"}},ask:{entry:Object(s.q)("LISTEN")}},on:{RECOGNISED:{target:"goFindIntent",actions:Object(s.b)({intent:function(t){return t.recResult[0].utterance}})},TIMEOUT:".prompt"}},goFindIntent:{initial:"getIntent",states:{getIntent:{invoke:{id:"getIntent",src:function(t,e){return n=t.intent,fetch(new Request("https://dialsys2022.herokuapp.com/model/parse",{method:"POST",body:'{"text": "'.concat(n,'"}')})).then((function(t){return t.json()}));var n},onDone:{target:"#root.dm.conversation.robotAction.goFindIntent.success",actions:[Object(s.b)({prediction:function(t,e){return e.data.intent.name}})]},onError:{target:"#root.dm.conversation.robotAction.goFindIntent.fail"}}},success:{entry:Object(s.q)((function(t){return{type:"SPEAK",value:"OK. I will ".concat((e=t.prediction,e.replace("_"," ")),".")};var e})),on:{ENDSPEECH:"#root.dm.conversation.robotAction.askNewIntent"}},fail:{entry:l("Sorry. Something went wrong."),on:{ENDSPEECH:"#root.dm.init"}}}},askNewIntent:Object(r.a)({},m((function(t){return{type:"SPEAK",value:"Do you want me to do anything else?."}}),"#root.dm.conversation.robotAction.askIntent","#root.dm.conversation.goodBye"))}},MeetX:Object(r.a)({},m((function(t){return{type:"SPEAK",value:"Do you want to meet ".concat(t.person,"?.")}}),"#root.dm.conversation.setDay","#root.dm.conversation.goodBye")),goodBye:{initial:"prompt",states:{prompt:{entry:l("OK. Good bye."),on:{ENDSPEECH:"#root.dm.init"}}}},createMeeting:Object(r.a)({},p((function(t){return{type:"SPEAK",value:"Let's create a meeting. What is it about?"}}),"#root.dm.conversation.setDay","title",{title:function(t){return y[t.recResult[0].utterance].title}})),setDay:Object(r.a)({},p((function(t){return{type:"SPEAK",value:"On which day is it?."}}),"#root.dm.conversation.askComplete","day",{day:function(t){return y[t.recResult[0].utterance].day}})),askComplete:Object(r.a)({},m((function(t){return{type:"SPEAK",value:"Will it take the whole day?."}}),"#root.dm.conversation.confirmationComplete","#root.dm.conversation.setTime")),setTime:Object(r.a)({},p((function(t){return{type:"SPEAK",value:"What time is your meeting?."}}),"#root.dm.conversation.confirmationTime","time",{time:function(t){return y[t.recResult[0].utterance].time}})),confirmationTime:Object(r.a)({},m((function(t){return{type:"SPEAK",value:"Do you want me to create a meeting titled ".concat(t.title," on ").concat(t.day," at ").concat(t.time,"?.")}}),"#root.dm.conversation.confirmationMeeting","#root.dm.conversation.welcome")),confirmationComplete:Object(r.a)({},m((function(t){return{type:"SPEAK",value:"Do you want me to create a meeting titled ".concat(t.title," on ").concat(t.day," for the whole day?.")}}),"#root.dm.conversation.confirmationMeeting","#root.dm.conversation.welcome")),confirmationMeeting:{initial:"prompt",states:{prompt:{entry:l("Your meeting has been created.")}},on:{ENDSPEECH:"#root.dm.init"}}}}}},E=function(t){return fetch(new Request("https://cors.eu.org/https://api.duckduckgo.com/?q=".concat(t,"&format=json&skip_disambig=1"))).then((function(t){return t.json()}))},S=n(160),O=n.n(S),h=n(163),T=n.n(h),v=n(13),j=a.a.send,C=a.a.cancel,R="northeurope";Object(d.a)({url:"https://statecharts.io/inspect",iframe:!1});var w=Object(c.a)({id:"root",type:"parallel",states:{dm:Object(r.a)({},b),asrtts:{initial:"init",states:{init:{on:{CLICK:{target:"getToken",actions:[Object(s.b)({audioCtx:function(t){return new(window.AudioContext||window.webkitAudioContext)}}),function(t){return navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){t.audioCtx.createMediaStreamSource(e)}))}]}}},getToken:{invoke:{id:"getAuthorizationToken",src:function(t,e){return k()},onDone:{actions:[Object(s.b)((function(t,e){return{azureAuthorizationToken:e.data}})),"ponyfillASR"],target:"ponyfillTTS"},onError:{target:"fail"}}},ponyfillTTS:{invoke:{id:"ponyTTS",src:function(t,e){return function(e,n){var o=T()({audioContext:t.audioCtx,credentials:{region:R,authorizationToken:t.azureAuthorizationToken}}),r=o.speechSynthesis,i=o.SpeechSynthesisUtterance;t.tts=r,t.ttsUtterance=i,t.tts.addEventListener("voiceschanged",(function(){t.tts.cancel();var n=t.tts.getVoices(),o=RegExp("en-US","u");o=RegExp("en-US","u");var r=n.find((function(t){return o.test(t.name)}));r?(t.voice=r,e("TTS_READY")):(console.error("TTS_ERROR: Could not get voice for regexp ".concat(o)),e("TTS_ERROR"))}))}}},on:{TTS_READY:"idle",TTS_ERROR:"fail"}},idle:{on:{LISTEN:"recognising",SPEAK:{target:"speaking",actions:Object(s.b)((function(t,e){return{ttsAgenda:e.value}}))}}},recognising:{initial:"noinput",exit:"recStop",on:{ASRRESULT:{actions:["recLogResult",Object(s.b)((function(t,e){return{recResult:e.value}}))],target:".match"},RECOGNISED:"idle",SELECT:"idle",CLICK:".pause",RECSTOP:"idle"},states:{noinput:{entry:["recStart",j({type:"TIMEOUT"},{delay:function(t){return 1e3*(t.tdmPassivity||3)},id:"timeout"})],on:{TIMEOUT:"#root.asrtts.idle",STARTSPEECH:"inprogress"},exit:C("timeout")},inprogress:{},match:{entry:j("RECOGNISED")},pause:{entry:"recStop",on:{CLICK:"noinput"}}}},speaking:{entry:"ttsStart",on:{ENDSPEECH:"idle",SELECT:"idle",CLICK:{target:"idle",actions:j("ENDSPEECH")}},exit:"ttsStop"},fail:{}}}}},{actions:{recLogResult:function(t){console.log("U>",t.recResult[0].utterance,t.recResult[0].confidence)},logIntent:function(t){console.log("<< NLU intent: "+t.nluData.intent.name)}}}),P=function(t){var e=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"name"===t.attribute}))||{}).value,n=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"image"===t.attribute}))||{}).value,o="circle";switch(!0){case t.state.matches({asrtts:"fail"})||t.state.matches({dm:"fail"}):break;case t.state.matches({asrtts:{recognising:"pause"}}):e="Click to continue";break;case t.state.matches({asrtts:"recognising"}):o="circle-recognising",e=e||"Listening...";break;case t.state.matches({asrtts:"speaking"}):o="circle-speaking",e=e||"Speaking...";break;case t.state.matches({dm:"idle"}):case t.state.matches({dm:"init"}):e="Click to start!",o="circle-click";break;default:e=e||"\xa0"}return Object(v.jsxs)("div",{className:"control",children:[Object(v.jsx)("figure",{className:"prompt",children:n&&Object(v.jsx)("img",{src:n,alt:e})}),Object(v.jsxs)("div",{className:"status",children:[Object(v.jsx)("button",Object(r.a)({type:"button",className:o,style:{}},t)),Object(v.jsx)("div",{className:"status-text",children:e})]})]})},A=function(t){var e=t.alternative.find((function(t){return"name"===t.attribute})).value,n=(t.alternative.find((function(t){return"image"===t.attribute}))||{}).value;return Object(v.jsxs)("figure",Object(r.a)(Object(r.a)({className:"flex"},t),{},{children:[n&&Object(v.jsx)("img",{src:n,alt:e}),Object(v.jsx)("figcaption",{children:e})]}))};function I(){var t=Object(u.b)(w,{devTools:!0,actions:{changeColour:Object(u.a)((function(t){document.body.style.background=t.recResult[0].utterance})),recStart:Object(u.a)((function(t){t.asr.start()})),recStop:Object(u.a)((function(t){t.asr.abort()})),ttsStart:Object(u.a)((function(t){var e='<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xmlns:mstts="http://www.w3.org/2001/mstts" xml:lang="en-US"><voice name="'.concat(t.voice.name,'">');e+=Object({NODE_ENV:"production",PUBLIC_URL:"/speechstate-lt2216",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SUBSCRIPTION_KEY:"92507829c4af47aa974e57ce5d63e029",REACT_APP_ASR_LANGUAGE:"en-US",REACT_APP_TTS_VOICE:"en-US"}).REACT_APP_TTS_LEXICON?'<lexicon uri="'.concat(Object({NODE_ENV:"production",PUBLIC_URL:"/speechstate-lt2216",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SUBSCRIPTION_KEY:"92507829c4af47aa974e57ce5d63e029",REACT_APP_ASR_LANGUAGE:"en-US",REACT_APP_TTS_VOICE:"en-US"}).REACT_APP_TTS_LEXICON,'"/>'):"",e+="".concat(t.ttsAgenda,"</voice></speak>"),console.debug(e);var n=new t.ttsUtterance(e);console.log("S>",t.ttsAgenda),n.voice=t.voice,n.onend=function(){return r("ENDSPEECH")},t.tts.speak(n)})),ttsStop:Object(u.a)((function(t){t.tts.cancel()})),ponyfillASR:Object(u.a)((function(t,e){var n=O()({audioContext:t.audioCtx,credentials:{region:R,authorizationToken:t.azureAuthorizationToken}}).SpeechRecognition;t.asr=new n,t.asr.lang="en-US",t.asr.continuous=!0,t.asr.interimResults=!0,t.asr.onresult=function(t){var e=t.results[0];e.isFinal?r({type:"ASRRESULT",value:[{utterance:e[0].transcript,confidence:e[0].confidence}]}):r({type:"STARTSPEECH"})}}))}}),e=Object(o.a)(t,2),n=e[0],r=e[1],i=(n.context.tdmExpectedAlternatives||[]).filter((function(t){return t.visual_information})).map((function(t,e){return Object(v.jsx)(A,{state:n,alternative:t.visual_information,onClick:function(){return r({type:"SELECT",value:t.semantic_expression})}},e)}));return Object(v.jsxs)("div",{className:"App",children:[Object(v.jsx)(P,{state:n,alternative:{},onClick:function(){return r("CLICK")}}),Object(v.jsx)("div",{className:"select-wrapper",children:Object(v.jsx)("div",{className:"select",children:i})})]})}var k=function(){return fetch(new Request("https://northeurope.api.cognitive.microsoft.com/sts/v1.0/issuetoken",{method:"POST",headers:{"Ocp-Apim-Subscription-Key":"92507829c4af47aa974e57ce5d63e029"}})).then((function(t){return t.text()}))},N=document.getElementById("root");i.render(Object(v.jsx)(I,{}),N)}},[[456,1,2]]]);
//# sourceMappingURL=main.7a9f6253.chunk.js.map